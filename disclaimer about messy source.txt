very messy codebase, I apologize in advance